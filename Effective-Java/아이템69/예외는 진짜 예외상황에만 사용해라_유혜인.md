# 예외는 진짜 예외 상황에만 사용하라

1. 예외는 예외 상황에 쓸 용도로 설계되었기에, 구현자 입장에서 최적화에 별 신경을 안쓰게 된다.
2. try-catch 블록에 넣으면 JVM이 적용할 수 있는 최적화가 제한된다. (속도 저하)
3. foreach문 같은 배열 순회는 JVM이 알아서 최적화해줌 

try-catch 블록 안에 반복문을 넣는 것과 같은 방식은 성능이 떨어지는 것은 물론, 엉뚱한 곳에서 버그를 숨기니 지양하는 것이 좋다 

즉, 예외는 오직 예외 상황에서만 쓰고 일상적 제어 흐름용으로 쓰지 말아야 한다.

- 상태 의존적 메소드를 제공하는 클래스는 상태 검사 메소드도 함께 제공하는 것이 좋다.

ex) Iterator의 next(), hasNext() 

- 아니면 optional 혹은 특정 값(null)을 사용할 수 있다.
    
    그러나, null 값은 NPE를 발생시킬 수 있어 지양하는 것이 좋다.
    
    [https://slenderankle.tistory.com/249](https://slenderankle.tistory.com/249)   → Null pointer를 막는 방법도 알아두자!
    

---

## Optional

자바 8 전에 메서드가 특정 조건에서 값을 반환할 수 없을 때 취할 수 있는 선택지는 2가지였다.

1. Exception throw
    
    단, 위에서 말했듯 예외는 반드시 예외상황에만 써야 한다.
    
    예외는 실행 스택을 추적해서 비용이 비싸다
    
2. null return
    
    null 리턴시에는 NPE를 항상 조심해야 한다.
    

<aside>
💡 값이 있을 수도 있고 없을 수도 있는 객체 optional을 사용할 수 있게 되었다.

</aside>

- 참조 타입의 객체를 한번 감싼 일종의 wrapper 클래스이다.
- 원소를 최대 1개 가질 수 있는 불변 collection 이다.
- 이전보다 null-safe한 로직 처리를 가능하게 한다.

| 메서드 | 설명 |
| --- | --- |
| Optional.ofNullable(T value) | value가 null이면, empty Optional을 반환하고, 값이 있으면 Optional.of로 생성 |
| Optional.of(T value) | 내부 값이 value인 Optional 객체 반환, null이면 NPE 발생 |
| Optional map(Funtion<? super T, ? extends U> f) | Optional 내부의 값을 Function을 통해 가공 |
| T get() | Optional 내의 값을 반환하나, null인 경우 NoSuchElementException 발생 |

… 이외에도 많은 메서드 제공 → [https://jaehun2841.github.io/2019/02/24/effective-java-item55/#Optional-메서드](https://jaehun2841.github.io/2019/02/24/effective-java-item55/#Optional-%EB%A9%94%EC%84%9C%EB%93%9C) 

### 자바 8 이전

```jsx
public class School {
    private ClassRoom classRoom;
}

public class ClassRoom {
    private Teacher teacher;
    private List<Student> students;
}

public class Teacher {
    private Subject subject;
    private String name;
}

public class Subject {
    private String subjectName;
}

// 여기서 이 학교의 교실의 선생님의 과목 반환 코드를 생성하려면?
school.getClassRoom().getTeacher().getSubject().getSubjectName();

// 보기도 안좋고, NULL-safe 하지 않다.

// 이걸 NULL-safe 하게 하려면 무한 if 지옥에 빠진다.
if(school == null) {
    return null;
}

ClassRoom classRoom = school.getClassRoom();
if(classRoom == null) {
    return null;
}

Teacher teacher = classRoom.getTeacher();
if(teacher == null) {
    return null;
}

Subject subject = teacher.getSubject();
if(subject == null) {
    return null;
}

return subject.getSubjectName();

// 위의 방식도 썩 좋진 않다.
```

### 자바 8 이후 (optional 사용)

```jsx
Optional.ofNullable(school).map(School::getClassRoom)    //Optional<School>
                           .map(ClassRoom::getTeacher)   //Optional<ClassRoom>
                           .map(Teacher::getSubject)     //Optional<Teacher>
                           .map(Subject::getSubjectName) //Optional<Subject>
                           .orElse(null);  // 값o이면 그 값 반환, null이면 other 반환
```

### 왜 optional 인가?

1. 기본값을 정해둘 수 있다.
    
    orElse(기본값) 으로 NPE 예외 생성을 막을 수 있다.
    
2. 원하는 예외를 던질 수 있다.
    
    ```java
    Toy myToy = max(toys).orElseThrow(TemperTantrumException::new);
    ```
    
    값이 없는 경우 원하는 예외를 던질 수 있다.
    

1. 항상 값이 채워져 있는 경우
    
    값이 없으면 NoSuchElementException이 발생
    
2. 기본값을 설정하는 비용이 큰 경우 : orElseGet 사용

참고 자료 : [https://jaehun2841.github.io/2019/02/24/effective-java-item55/#Optional-이란](https://jaehun2841.github.io/2019/02/24/effective-java-item55/#Optional-%EC%9D%B4%EB%9E%80)